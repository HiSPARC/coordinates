\tdplotsetmaincoords{70}{95}

\pgfmathsetmacro{\rlen}{1.8}
\pgfmathsetmacro{\latitude}{90-45}  % phi
\pgfmathsetmacro{\longitude}{120}  % lambda

\pgfmathsetmacro{\clen}{3}
\pgfmathsetmacro{\ra}{33}  % right ascension in degrees
\pgfmathsetmacro{\dec}{90-50}  % declination in degrees

\pgfmathsetmacro{\gmst}{-45}  % Greenwich mean sidereal time
\pgfmathsetmacro{\lst}{\longitude+\gmst}  % local sidereal time in degrees

%\pgfmathsetmacro{\zenith}{22}  % theta
%\pgfmathsetmacro{\azimuth}{0}  % phi

\begin{tikzpicture}[scale=2,thick,tdplot_main_coords]

    \definecolor{base}{RGB}{128,128,128}; % grey
    \definecolor{wgs84}{RGB}{255,153,0}; % orange
    \definecolor{ecef}{RGB}{13,98,153}; % blue
    \definecolor{enu}{RGB}{0,184,0}; % green
    \definecolor{compass}{RGB}{125,10,255}; % purple
    \definecolor{equa}{RGB}{253,39,39}; % red
    \definecolor{time}{RGB}{15,171,135}; % teal

    \coordinate (O) at (0,0,0);

    % base
    \draw[base] (O) circle (\rlen);
    \draw[base] (\rlen,-.2,0);  % Equator
    \tdplotsetthetaplanecoords{90};
    \draw[base,tdplot_rotated_coords] (O) circle (\rlen);
    \tdplotsetthetaplanecoords{\gmst};
    % Prime Meridian
    \draw[base,tdplot_rotated_coords] (\rlen,0,0) arc (0:90:\rlen);
    \tdplotsetthetaplanecoords{\lst};
    \draw[base,dashed,tdplot_rotated_coords] (\rlen,0,0) arc (0:90:\rlen);
    \draw[base,dashed,tdplot_rotated_coords] (\clen,0,0) arc (0:90:\clen);
    \draw[base,dashed,tdplot_rotated_coords] (0,0,0) -- (0,\clen,0);

    % celestial base
    \draw[base] (O) circle (\clen);
    \draw[base] (\clen,-.8,0)
        node[anchor=north east,rotate=-10] {Celestial Equator};
    \draw[base,->,-stealth] (O) -- (0,0,\clen + .3)
        node[anchor=south] {Celestial North Pole};
    \tdplotsetthetaplanecoords{90};
    \draw[base,tdplot_rotated_coords] (O) circle (\clen);

    % ECEF
    \tdplotsetrotatedcoords{0}{0}{\gmst};
    \draw[ecef,->,-stealth,tdplot_rotated_coords] (O) -- (\rlen+.2,0,0)
        node[anchor=north] {$X$};
    \draw[ecef,->,-stealth,tdplot_rotated_coords] (O) -- (0,\rlen+.2,0)
        node[anchor=west] {$Y$};
    \draw[ecef,->,-stealth,tdplot_rotated_coords] (O) -- (0,0,\rlen+.2)
        node[anchor=west] {$Z$};

    % WGS84
    % longitude
    \tdplotsetrotatedcoords{0}{0}{\gmst};
    \tdplotdrawarc[wgs84,->,-stealth,tdplot_rotated_coords]
        {(O)}{0.4}{0}{\longitude}{anchor=north}{$\lambda$};
    % latitude
    \tdplotsetthetaplanecoords{\lst};
    \tdplotdrawarc[wgs84,->,-stealth,tdplot_rotated_coords]
        {(0,0,0)}{0.4}{90}{\latitude}{anchor=west}{$\phi$};

    % gmst
    \tdplotsetthetaplanecoords{\lst};
    \tdplotdrawarc[time,->,-stealth]
        {(O)}{\rlen}{0}{360+\gmst}{anchor=south}{GMST};
    \tdplotdrawarc[time,->,-stealth]
        {(O)}{\clen}{\lst}{\ra}{anchor=north west}{HA};

    % observer
    \tdplotsetcoord{P}{\rlen}{\latitude}{\lst};
    \tdplotsetcoord{P'}{\clen}{\latitude}{\lst};
    \draw[color=black,->,-stealth] (O) -- (P);
    \draw[base] (P) -- (P') node[anchor=south west] {Zenith};
    \draw[base,dashed] (P) -- (Pxy);

    % Equatorial
    \draw[base,->,-stealth] (O) -- (\clen + .3,0,0)
        node[anchor=north]{$\vernal$};

    \tdplotsetcoord{S}{\clen}{\dec}{\ra};
    \draw[->,-stealth] (O) -- (S) node[anchor=south west] {$\star$};
    \draw[base,dashed] (S) -- (Sxy);

    \tdplotsetthetaplanecoords{\ra};
    \draw[base,dashed,tdplot_rotated_coords] (\clen,0,0) arc (0:90:\clen);
    \draw[base,dashed,tdplot_rotated_coords] (0,0,0) -- (0,\clen,0);
    \tdplotdrawarc[equa,->,-stealth,tdplot_rotated_coords]
        {(0,0,0)}{\clen}{90}{\dec}{anchor=west}{$\delta$};
    \tdplotdrawarc[equa,->,-stealth]
        {(O)}{\clen}{0}{\ra}{anchor=north}{$\alpha$};

\end{tikzpicture}

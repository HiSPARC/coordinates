\begin{abstract}

This is meant as documentation to describe the coordinate system and
units used in \hisparc data and analysis. We also have to deal with
other coordinate systems such as the one used in \corsika and some used
as intermediary in coordinate transformations. The conversions and
relations between these systems are given.

\end{abstract}


\section{Introduction}

Since we have to works with many coordinate systems it can be hard to
keep track of the definitions of each. This document is meant as a
reference to easily find the relations between the different systems.
First coordinate systems used by \hisparc will be discussed. Including
the units that are used and where it is used. Then other coordinate
systems that we have to deal with are discussed, including ways to
convert from those to our usual coordinate systems.


\section{Geographic}

Geographic coordinate systems define a point on the Earth. Multiple
systems are important; WGS84, ECEF and ENU. Additionally a compass based
system is used for detector locations relative to \gps antenna. These
systems are described in the following sections.
\figref{fig:wgs84_ecef_enu} shows the relationships between the global
systems. The conversion formulae are taken from \cite{wikipedia:2014aa}.

\begin{figure}
    \centering
    \input{Figures/WGS84_ECEF_ENU}
    \caption{Relationship between the WGS84 (orange), ECEF (blue) and ENU
             (green) coordinate systems.}
    \label{fig:wgs84_ecef_enu}
\end{figure}


\subsection{World Geodetic System 1984 (WGS84)}

For the location of a station we use a \gps antenna. The \gps returns
coordinates in the WGS84 coordinate system. This defines a position with
a latitude, longitude and altitude. The latitude ($\phi$) and longitude
($\lambda$) are defined in decimal degrees, the altitude in meters.
Latitude is the angular distance between a location and the equator,
angles towards north are positive. The longitude is the angular distance
of a location to the Prime Meridian, angles towards east are positive.
The altitude is the height above an ellipsoid that approximates the
shape of the Earth, the parameters that define this ellipsoid are given
in \eqref{eq:wgs84}.


\subsection{Earth-Centered, Earth-Fixed (ECEF)}

This coordinate has its origin as the center of the Earth
(Earth-Centered), and its axes are aligned with the WGS84 system. The
z-axis points to North. The x-axis crosses the Earth where the equator
(\SI{0}{\degree} latitude) intersects with the prime meridan
(\SI{0}{\degree} longitude).

The formulae to convert WGS84 to ECEF are:

\begin{equation}
    \begin{array}{l}
        X = (N + \mathrm{altitude}) \cos{\phi} \cos{\lambda} \ , \\
        Y = (N + \mathrm{altitude}) \cos{\phi} \sin{\lambda} \ , \\
        Z = (\frac{b^2}{a^2} N + \mathrm{altitude}) \sin{\phi} \ . \\
    \end{array}
\end{equation}

Where the ellipsoid is defined by

\begin{equation}
    \label{eq:wgs84}
    \begin{array}{l}
        a = \SI{6378137.0}{\meter} \ , \\
        f = \frac{1}{298.257223563} \ , \\
        b = a (1 - f) \ , \\
        e = \sqrt{2 f - f^2} \ , \\
        N = \frac{a}{\sqrt{1 - e^2 \sin{\phi}^2}} \ , \\
    \end{array}
\end{equation}

\noindent
here $a$ is the semi-major axis, $f$ the flattening, $b$ the semi-minor
axis and $e$ the eccentricity of the ellipsoid. $N$ is the Normal, which
is the distance from the surface of the ellipsoid to the intersection
between the normal of the location on the ellipsoid and the z-axis.


\subsection{East, North, Up (ENU)}

East, North, Up is used by us to easily get distances, relative locations
and angles between locations. It is a local coordinate system where its
origin (reference position) can be chosen. From the reference location
east is the positive x-axis, north is the positive y-axis and up (towards
Zenith) is the positive z-axis. All distances are in meters.

The formulae to convert ECEF to ENU with a reference position are:

\begin{equation}
    \begin{bmatrix}
    x \\ y \\ z
    \end{bmatrix}
    = 
    \begin{bmatrix}
                 -\sin(\lambda_r) &               \cos(\lambda_r) &           0. \\
    -\sin(\phi_r) \cos(\lambda_r) & -\sin(\phi_r) \sin(\lambda_r) & \cos(\phi_r) \\
     \cos(\phi_r) \cos(\lambda_r) &  \cos(\phi_r) \sin(\lambda_r) & \sin(\phi_r)
    \end{bmatrix}
    \begin{bmatrix}
    X - X_r \\ Y - Y_r \\ Z - Z_r
    \end{bmatrix}
\end{equation}

where  $(X, Y, Z)$ and $(x, y, z)$ are the location in ECEF and ENU
respectively. $(\phi_r, \lambda_r)$ and $(X_r, Y_r, Z_r)$ are the
reference position in WGS84 and ECEF respectively.


\subsection{Compass}

For reconstructions of events the location of the individual detectors
are required. To measure the location of detectors in a station we need
to define the positions of detectors relative to the \gps antenna,
because that position is known. We use a simple system that requires a
distance and angle measurement, see \figref{fig:enu_compass}. The
distance (r) between the \gps and a detector (center of the
scintillator) is measured (in meters) the angle ($\alpha$) relative to
the North Pole is determined using a compass. This angle is in degrees
and goes from North to East (NESW). Note that there is a difference
between the magnetic and geographic north pole. The difference can be up
to \SI{3}{\degree} for some \hisparc station locations
\cite{canada:2013aa}. The rotation angle of the detector itself
($\beta$) is defined and the angle of the long side of the detector
relative to the North Pole (positive towards East).

\begin{figure}
    \centering
    \input{Figures/ENU_compass}
    \caption{Relationship between the ENU (green) and Compass (purple)
             coordinate system and how it is used to define the position
             and rotation of a detector.}
    \label{fig:enu_compass}
\end{figure}

The formulae to convert the location of a station in Compass coordinates
to ENU are:

\begin{equation}
    \begin{array}{l}
        x = r * \sin{\alpha} \ , \\
        y = r * \cos{\alpha} \ , \\
        z = z \ . \\
    \end{array}
\end{equation}


\section{Time}

For \hisparc detection events it is important to know precisely when
they occur, a \gps is used to get synchronized and precise timing. This
gives us a timestamp, but this needs to be converted to other time
systems.


\subsection{\gps time}

From they \gps we get a timestamp which are the number of nanoseconds
since the UNIX epoch 1 January 1970 00:00:00.000000000. The \gps
timestamp is a continuously increasing number. This is different from
the UTC timestamp in which certain seconds are repeated when `leap
seconds' are added. Leap seconds are used to keep UTC close to the mean
solar time. Currently the difference between UTC and \gps time is 16
seconds \cite{usno:2012aa}.


\subsection{UTC time}

Similar to \gps but corrected to keep it more in sync with solar time.


\subsection{Julian Date (JD)}

Decimal number to count the number of days since 1 January 4713 B.C.
12:00:00.

Modified Julian Date to keep number shorter uses epoch 17 November 1858
00:00:00. The difference between a Modified Julian Date and a Julian
Date is 2400000.5 days.

\begin{equation}
    MJD = JD - 2400000.5
\end{equation}


\subsection{Greenwich Mean Sidereal Time (GMST)}

Rotation of the prime meridian relative to the vernal equinox, usually
expressed in hours. In a solar day the Earth rotates more than
\SI{360}{\degree} around its axis because it is also in orbit around the
Sun, causing the position of the Sun relative to the Earth to change. In
sidereal time the rotation of Earth relative to the `fixed' background
stars is taken. A sidereal day is a full rotation of Earth around its
axis. This is around 4 minutes shorter than a solar day.

\cite{kaplan:2011aa}


\subsection{Local Sidereal Time (LST)}

Similar to GMST but takes observers longitude into account.

To get the Local Sidereal Time the extra angle of the observers
longitude has to be added to the GMST.

\begin{equation}
    \begin{array}{l}
        \mathit{LST} = \mathit{GMST} + \lambda 15 \ . \\
    \end{array}
\end{equation}

\section{Celestial}

Here we describe the different coordinate systems that are used to
define the direction (origin) of an air shower.

\begin{figure}
    \centering
    \input{Figures/WGS84_Equatorial}
    \caption{Relationship between the WGS84 (orange), ECEF (blue),
             Equatorial (red) and clock (teal) coordinate systems.
             $\vernal$ points to the vernal equinox, the point where the
             ecliptic and celestial equator cross in the Aries zodiac.}
    \label{fig:wgs84_equatorial}
\end{figure}


\subsection{Zenith and Azimuth}

When a station detects a shower we try to reconstruct the direction of
its origin. The direction of a shower is then given by an zenith and
azimuth coordinate. These coordinates define a point on the semi-sphere
that is the sky above the detection station. The Zenith is the point
directly above the observer. The zenith angle is the angle between the
direction and the Zenith point. The azimuth is the direction in the
horizontal plane, it starts at East (\SI{0}{\radian}) then goes to North
(ENWS).

We do not expect nor consider air showers from below the horizon, so the
zenith angles, defined in radians, are an angle in the range [0,
$\frac{\pi}{2}$). The azimuth is restricted to the range [$-\pi$, $\pi$).

\begin{figure}
    \centering
    \input{Figures/ENU_Horizontal}
    \caption{Relationship between the ENU (green), Zenith Azimuth (pink)
             and horizontal (gold) coordinate systems.}
    \label{fig:enu_horizontal}
\end{figure}


\subsection{Horizontal}

This is a system used as intermediary for some coordinate conversions.
It uses azimuth ($A$) and altitude ($a$) to define a direction. The
altitude is the opposite of the zenith, so \SI{0}{\radian} is horizontal
and \SI{\pi / 2}{\radian} is the zenith. The azimuth definition also
differs, in Horizontal coordinates it moves from North to East (NESW).

The formulae to convert from zenith ($\theta$) and azimuth ($\phi$) to
altitude ($a$) and azimuth ($A$) are:

\begin{equation}
    \begin{array}{l}
        a = \frac{\pi}{2} - \theta \ , \\
        A = - (\phi + \frac{\pi}{2}) \ . \\
    \end{array}
\end{equation}


\subsection{Equatorial (J2000)}

Vernal equinox, epoch.
Right ascension, Declination, J2000
In decimal hours.

Given an observers position in WGS84, a time of observation in LST and
horizontal coordinates pointing to the source the following formulae can
be used to get the corresponding equatorial coordinates \cite[p.
37]{duffet-smith:1990aa}.

\begin{equation}
    \begin{array}{l}
        \delta = \arcsin{((\sin{a} \sin{\phi}) +
                          (\cos{a} \cos{\phi} \cos{A}))} \ , \\
        \mathit{HA} = \arccos{(\frac{\sin{a} - (\sin{\phi} \sin{\delta})}
                                    {\cos{\phi} \cos{\delta}})} \ , \\
        \alpha = \mathit{LST} - \mathit{HA} \ . \\
    \end{array}
\end{equation}

Where $\phi$ the geographical latitude, $a$ the altitude, $A$ the
azimuth, $\mathit{LST}$ the Local sidereal time, $\delta$ is the
declination, $\alpha$ the right ascension and the intermediate variable
$\mathit{HA}$ is the hour angle.


\section{\corsika}

\corsika an extensive air shower simulation program which we use.
\corsika uses a coordinate system which is slightly different from the
ENU system that we use \cite{heck:2013aa}.

\begin{figure}
    \centering
    \input{Figures/ENU_CORSIKA}
    \caption{Relationship between the ENU (green), horizontal (pink)
             and CORSIKA (brown) coordinates.}
    \label{fig:enu_corsika}
\end{figure}


\subsection{Geographic}

\corsika defines positions on the ground (or observation level) relative
to the point where the shower axis intersects the observation level.
Positive x axis points to magnetic North, positive y axis to the West,
and the z axis upwards.

The formulae to convert CORSIKA to ENU are:

\begin{equation}
    \begin{array}{l}
        x_{\mathrm{ENU}} = -y_{\mathrm{CORSIKA}} \ , \\
        y_{\mathrm{ENU}} = x_{\mathrm{CORSIKA}} \ , \\
        z_{\mathrm{ENU}} = z_{\mathrm{CORSIKA}} \ . \\
    \end{array}
\end{equation}


\subsection{Celestial}

\corsika looks from the point of view of the shower, so not the
direction it came form, but the direction it goes to. The $\Theta$ angle
is defined the same as our definition of zenith ($\theta$),
\SI{0}{\radian} is a shower from the zenith and \SI{\pi / 2}{\radian} is
a horizontal shower. The $\Phi$ angle is defined differently than our
definition of azimuth ($\phi$). First it is the angle the shower is heading
towards. \SI{0}{\radian} is a shower heading towards North, so coming
form South, which we would define as \SI{\pi / 2}{\radian}. The
(positive) rotation of the angle is in the same direction, from North to
West.

The formulae to convert the CORSIKA direction to our azimuth and zenith are:

\begin{equation}
    \begin{array}{l}
        \theta = \Theta \ , \\
        \phi = \Phi - \frac{\pi}{2} \ . \\
    \end{array}
\end{equation}


\printbibliography

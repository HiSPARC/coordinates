\begin{abstract}

This is meant as documentation to describe the coordinate system and
units used in \hisparc data and analysis. We also have to deal with
other coordinate systems such as the one used in \corsika and some used
as intermediary in coordinate transformations.

\end{abstract}


\section{Introduction}

First coordinate systems used by \hisparc will be discussed. Including
the units used and where it is used. Then other coordinate systems that
we have to deal with are discussed, including ways to convert from those
to our usual coordinate systems.


\section{Geographic}

Geographic coordinate systems define a point on the Earth. Multiple
systems are important; WGS84, ECEF and ENU. Additionally a compass based
system is used for detector locations relative to GPS antenna. These
systems are described in the following sections.
\figref{fig:wgs84_ecef_enu} shows the relationships between the systems.
The conversion formula are taken from \cite{wikigeodetic}.

\begin{figure}
    \centering
    \input{Figures/WGS84_ECEF_ENU}
    \caption{Relationship between the WGS84 (orange), ECEF (blue) and ENU
             (green) coordinate systems.}
    \label{fig:wgs84_ecef_enu}
\end{figure}


\subsection{World Geodetic System 1984 (WGS84)}

For the location of a station we use a \gps antenna. The \gps returns
coordinates in the WGS84 coordinate system. This defines a position with
a latitude, longitude and altitude. The latitude ($\phi$) and longitude
($\lambda$) are defined in decimal degrees, the altitude in meters.
Latitude is positive towards West and longitude is positive towards
North.


\subsection{Earth-Centered, Earth-Fixed (ECEF)}

This coordinate has its origin as the center of the Earth
(Earth-Centered), and its axes are aligned with the WGS84 system. The
z-axis points to North. The x-axis crosses the Earth where the equator
(\SI{0}{\degree} latitude) intersects with the prime meridan
(\SI{0}{\degree} longitude).

The formulae to convert WGS84 to ECEF are:

\begin{equation}
    \begin{array}{l}
        X = (N + altitude) \cos{\phi} \cos{\lambda} \ , \\
        Y = (N + altitude) \cos{\phi} \sin{\lambda} \ , \\
        Z = (\frac{b^2}{a^2} N + altitude) \sin{\phi} \ . \\
    \end{array}
\end{equation}

Where
\begin{equation}
    \begin{array}{l}
        N = \frac{a}{\sqrt{1 - e^2 \sin{\phi}^2}} \ , \\
    \end{array}
\end{equation}

and $b$ is the semi-minor axis, $a$ the semi-major axis and $e$ the
eccentricity of the ellipsoid.


\subsection{East, North, Up (ENU)}

East North Up is used by us to easily get distances, relative locations
and angles between locations. It is a local coordinate system where its
origin (reference position) can be chosen. From the reference location
east is positive x-axis, north is positive y-axis and up (towards
zenith) is the positive z-axis. All distances are in meters.

The formulae to convert ECEF to ENU with a reference position are:

\begin{equation}
    \begin{bmatrix}
    x \\ y \\ z
    \end{bmatrix}
    = 
    \begin{bmatrix}
                   -\sin(\lambda) &             \cos(\lambda) &         0. \\
        -\sin(\phi) \cos(\lambda) & -\sin(\phi) \sin(\lambda) & \cos(\phi) \\
         \cos(\phi) \cos(\lambda) &  \cos(\phi) \sin(\lambda) & \sin(\phi)
    \end{bmatrix}
    \begin{bmatrix}
    X - X_r \\ Y - Y_r \\ Z - Z_r
    \end{bmatrix}
\end{equation}

where $X_r, Y_r$ and $Z_r$ are the reference position in ECEF.



\subsection{Compass}

The \gps antenna is often not at the center of a station, so detector
location relative to the \gps are also needed. To measure the location
of detectors in a station we need to define the positions of detectors
relative to the \gps antenna, because that position is known. We use a
simple system that requires a distance and angle measurement, see
\figref{fig:enu_compass}. The distance (r) between the \gps and a
detector (center of the scintillator) is measured (in meters) the angle
($\alpha$) relative to the North Pole is determined using a compass.
This angle is in degrees and goes from North to East. [Note about
Magnetic/Geographic North...]. The rotation angle of the detector itself
($\beta$) is defined and the angle of the long side of the detector
relative to the North Pole (positive towards East).

\begin{figure}
    \centering
    \input{Figures/ENU_compass}
    \caption{Relationship ENU (green) and compass (purple) coordinate system
             and how it is used to define the position of a detector.}
    \label{fig:enu_compass}
\end{figure}

The formulae to convert Compass to ENU are:

...


\section{Celestial}

\subsection{Azimuth and Zenith}

When a station detects a shower we try to reconstruct the direction of
its origin. The direction of a shower is then given by an azimuth and
zenith coordinate. These coordinates define a point on the semi-sphere
that is the sky above the detection station. The zenith is the point
directly above the observer. The zenith angle is the angle between the
direction and the zenith point. The azimuth is the direction in the
horizontal plane, it starts at East then goes to North (ENWS).

We do not expect nor consider air showers from below the horizon, so the
zenith angles, defined in radians, are and angle in the range (0,
$\frac{\pi}{2}$). The azimuth is restricted to the range ($-\pi$, $\pi$).


\subsection{Horizontal}

This is a system used as intermediary for some coordinate conversions.
It uses azimuth and altitude to define a direction. The altitude is the
opposite of the zenith, so 0 is horizontal and $\frac{\pi}{2}$ is the
zenith. The azimuth definition also differs, it moves from North to East
(NESW).


\subsection{Equatorial (J2000)}

Vernal equinox, epoch.
Right ascension, Declination, J2000
In decimal hours.


\section{\corsika}

\corsika an extensive air shower simulation program which we use.
\corsika uses a coordinate system which is slightly different from the
ENU system that we use\cite{corsika}.


\subsection{Geographic}

\corsika defines positions on the ground (or observation level) relative
to the core of the shower(??). Positive x axis points to magnetic North,
positive y axis to the West, and the z axis upwards.


\subsection{Celestial}

As origin of the shower \corsika looks from the point of view of the
shower. The $\theta$ angle is defined the same as our definition of
zenith, \SI{0}{\radian} is a shower from the zenith and
\SI{\pi / 2}{\radian} is a horizontal shower. The $\phi$ angle is
defined differently than our definition of azimuth. First it is the
angle the shower is heading towards. \SI{0}{\radian} is a shower heading
towards North, so coming form South, which we would define as
\SI{\pi / 2}{\radian}. The (positive) rotation of the angle is
in the same direction, from North to West. So the conversion is:.


\bibliography{References}

\begin{thebibliography}{9}

\bibitem{wikigeodetic}
Geodetic system. In Wikipedia. Retrieved August 10, 2004,
from \url{http://en.wikipedia.org/wiki/Geodetic_system}

\bibitem{corsika}
Extensive Air Shower Simulation with CORSIKA: A Userâ€™s Guide. D. Heck
and T. Pierog. September 3, 2013. Chapter 6 Coordinate System.

\bibitem{tikz3d}
The tikz-3dplot Package. J. Hein. January 11, 2012.

\end{thebibliography}

\begin{abstract}

The coordinate systems and units used in \hisparc data and analysis are
illustrated and described. We also have to deal with other coordinate
systems such as the one used in \corsika and some used as intermediary
in coordinate transformations. The conversions and relations between
these systems are given.

\end{abstract}


\section{Introduction}

Since we have to works with many coordinate systems it can be hard to
keep track of the definitions of each. This document is meant as a
reference to easily find the relations between the different systems.
First coordinate systems used by \hisparc will be discussed. Including
the units that are used and where it is used. Then other coordinate
systems that we have to deal with are discussed, including ways to
convert from those to our usual coordinate systems.


\section{Geographic}

Geographic coordinate systems define a point on the Earth. Multiple
systems are important; WGS84, ECEF and ENU. \figref{fig:wgs84_ecef_enu}
illustrates the relationships between these systems. Additionally a
compass based system is used for detector locations relative to \gps
antenna. These systems are described in the following sections. The
conversion formulae are taken from \cite{wikipedia:2014aa}.

\begin{figure}
    \centering
    \input{Figures/WGS84_ECEF_ENU}
    \caption{Relationship between the WGS84 (orange), ECEF (blue) and ENU
             (green) coordinate systems. The Prime meridian is the IERS
             Reference Meridian.}
    \label{fig:wgs84_ecef_enu}
\end{figure}


\subsection{World Geodetic System 1984 (WGS84)}

For the location of a station we use a \gps antenna. The \gps returns
coordinates in the WGS84 coordinate system. This defines a position with
a latitude, longitude and altitude. The latitude ($\phi$) and longitude
($\lambda$) are defined in decimal degrees, the altitude in meters.
Latitude is the angular distance between a location and the equator,
angles towards north are positive. The longitude is the angular distance
of a location to the IERS Reference Meridian (from now on referred to as
the prime meridian), angles towards east are positive. The altitude is
the height above an ellipsoid that approximates the shape of the Earth,
the parameters that define this ellipsoid are given in \eqref{eq:wgs84}.


\subsection{Earth-Centered, Earth-Fixed (ECEF)}

This coordinate has its origin as the center of the Earth
(Earth-Centered), and its axes are aligned with the WGS84 system. The
z-axis points to North. The x-axis crosses the Earth surface where the
equator (\SI{0}{\degree} latitude) intersects with the prime meridan
(\SI{0}{\degree} longitude). The y-axis intersects the equator at
\SI{90}{\degree} longitude. The axes rotate with the Earth
(Earth-Fixed). A position is defined by the $X$, $Y$, and $Z$
coordinates.

The formulae to convert WGS84 to ECEF are:

\begin{equation}
    \begin{array}{l}
        X = \left(N + \mathrm{altitude}\right) \cos{\phi} \cos{\lambda} \ , \\
        Y = \left(N + \mathrm{altitude}\right) \cos{\phi} \sin{\lambda} \ , \\
        Z = \left(\frac{b^2}{a^2} N + \mathrm{altitude}\right) \sin{\phi} \ . \\
    \end{array}
\end{equation}

\noindent
Where the ellipsoid is defined by

\begin{equation}
    \label{eq:wgs84}
    \begin{array}{l}
        a = \SI{6378137.0}{\meter} \ , \\
        f = \frac{1}{298.257223563} \ , \\
        b = a (1 - f) \ , \\
        e = \sqrt{2 f - f^2} \ , \\
        N = \frac{a}{\sqrt{1 - e^2 \sin{\phi}^2}} \ , \\
    \end{array}
\end{equation}

\noindent
here $a$ is the semi-major axis, $f$ the flattening, $b$ the semi-minor
axis and $e$ the eccentricity of the ellipsoid. $N$ is the Normal, which
is the distance from the surface of the ellipsoid to the intersection
between the normal of the location on the ellipsoid and the z-axis.


\subsection{East, North, Up (ENU)}

East, North, Up is used by us to easily get distances, relative locations
and angles between locations. It is a local coordinate system where its
origin (reference position) can be chosen. From the reference location
east is the positive x-axis, north is the positive y-axis and up (towards
Zenith) is the positive z-axis. All distances are in meters.

The formulae to convert ECEF to ENU with a reference position are:

\begin{equation}
    \begin{bmatrix}
    x \\ y \\ z
    \end{bmatrix}
    =
    \begin{bmatrix}
                 -\sin(\lambda_r) &               \cos(\lambda_r) &           0. \\
    -\sin(\phi_r) \cos(\lambda_r) & -\sin(\phi_r) \sin(\lambda_r) & \cos(\phi_r) \\
     \cos(\phi_r) \cos(\lambda_r) &  \cos(\phi_r) \sin(\lambda_r) & \sin(\phi_r)
    \end{bmatrix}
    \begin{bmatrix}
    X - X_r \\ Y - Y_r \\ Z - Z_r
    \end{bmatrix}
\end{equation}

where  $(X, Y, Z)$ and $(x, y, z)$ are the location in ECEF and ENU
respectively. $(\phi_r, \lambda_r)$ and $(X_r, Y_r, Z_r)$ are the
reference position in WGS84 and ECEF respectively.


\subsection{Compass}

For reconstructions of events the location of the individual detectors
are required. To measure the location of detectors in a station we need
to define the positions of detectors relative to the \gps antenna,
because that position is known. We use a simple system that requires a
distance and angle measurement, see \figref{fig:enu_compass}. The
distance ($r$) between the \gps and a detector (center of the
scintillator) is measured (in meters), the angle ($\alpha$) relative to
the North Pole is determined using a compass. This angle is in degrees
and goes from North to East (NESW). Note that there is a difference
between the magnetic and geographic north pole. The difference can be up
to \SI{3}{\degree} for some \hisparc station locations
\cite{canada:2013aa}. The rotation angle of the detector itself
($\beta$) is defined and the angle of the long side of the detector
relative to the North Pole (positive towards East).

\begin{figure}
    \centering
    \input{Figures/ENU_compass}
    \caption{Relationship between the ENU (green) and Compass (purple)
             coordinate system and how it is used to define the position
             and rotation of a detector.}
    \label{fig:enu_compass}
\end{figure}

The formulae to convert the location of a station in Compass coordinates
to ENU are:

\begin{equation}
    \begin{array}{l}
        x = r * \sin{\alpha} \ , \\
        y = r * \cos{\alpha} \ , \\
        z = z \ . \\
    \end{array}
\end{equation}


\section{Time}

For \hisparc detection events it is important to know precisely when
they occur, a \gps is used to get synchronized and precise timing. This
gives us a timestamp, but this needs to be converted to other time
systems.


\subsection{\gps time}

\gps time started counting on 6 January 1980 00:00 UTC, i.e.
\num{315964800} UNIX seconds after the UNIX epoch of 1 January 1970
00:00 UTC. \gps time is a continuously increasing number. This is
different from UTC time in which certain seconds are repeated when `leap
seconds' are added. Currently the difference between UTC and \gps time
is 16 seconds. From the \hisparc electronics we get a UNIX timestamp in
\gps time. The timestamp is given in nanoseconds, i.e. the number of
nanoseconds that have passed since the UNIX epoch. The \gps timestamp is
a large number and requires 64-bits to represent the number. For
instance the \gps timestamp for 1 December 2014 at 00:00:29.886222166
(\gps time) is \num{1417392029886222166}. \cite{usno:2012aa}.


\subsection{UTC time}

Similar to \gps but corrected with leap seconds to keep it more in sync
with solar time. A leap second means that a second is counted twice. The
International Earth Rotation and Reference Systems Service (IERS)
decides when to add leap seconds. \hisparc does not use UTC time because
of the duplicate timestamps, which makes it possible for a station to
detect two events at the `same time'. Moreover, it causes issues when
looking for coincidences between stations.


\subsubsection{Leap seconds}

Leap seconds can be introduced at the end of either 30 June or 31
December, the leap second is represented in UTC time as 23:59:60.
\tabref{table:leapseconds} gives a list of the recent leap seconds,
which are important for \hisparc. Leap seconds are announced about 6
months before they take effect.

\begin{table}
    \centering
    \begin{tabular}{ l | c }
        Date & Leap seconds \\
        \hline
        31 December, 1998 & 13 \\
        31 December, 2005 & 14 \\
        31 December, 2008 & 15 \\
        30 June, 2012 & 16 \\
        \hline
    \end{tabular}
   \caption{Leap seconds in effect or introduced after 2002. This is the
            amount of seconds that \gps time is ahead of UTC time.}
   \label{table:leapseconds}
\end{table}


\subsection{Julian Date (JD)}

Decimal number counting the number of days since 1 January 4713 B.C.
12:00:00. Calculating this is not trivial since one has to account for
the fact that the 5th up to and including the 14th of October in 1582 do
not exist. Those ten days were skipped because the Julian calendar,
which was used before that gap, introduced to many leap years, every
year divisible by 4 was a leap year. The Gregorian calendar used
afterwards compensated by having less leap years. Leap years still occur
when years are divisible by 4, except when they are also divisible by
100, except when they are also divisible by 400. For example 1900 and
1999 are not a leap years, but 2000 and 2004 are. \cite{acf:2014aa}

\subsubsection{Modified Julian Date (MJD)}

Modified Julian Date to keep number shorter uses epoch 17 November 1858
00:00:00. The difference between a Modified Julian Date and a Julian
Date is 2400000.5 days.

\begin{equation}
    MJD = JD - 2400000.5
\end{equation}


\subsection{Sidereal Time}

In a solar day the Earth rotates more than \SI{360}{\degree} around its
axis because it orbits around the Sun, causing the position of the Sun
relative to the Earth to change. The Earth orbits the Sun every 365.25
days, so in one day the the orbit proceeds by
$\frac{\SI{360}{\degree}}{\SI{365.25}{\day}} \approx
\SI{1}{\degree\per\day}$. So an extra rotation of approximately
\SI{1}{\degree} around its axis is required to make the same part of the
Earth face the Sun (a solar day). In sidereal time the rotation of Earth
relative to the `fixed' background stars is taken. A sidereal day is a
full rotation of Earth around its axis, relative to background stars.
This is around \SI{4}{\minute} shorter than a solar day. In
\figref{fig:sidereal_time} the difference between a solar and sidereal
day is illustrated.

\begin{figure}
    \centering
    \input{Figures/Sidereal_time}
    \caption{This shows the orbit of Earth (green) around the Sun
             (yellow). The black line on the Earth represents the prime
             meridian. A full rotation of the Earth causes the prime
             meridian to point to the same background stars, this is a
             sidereal day. It takes longer, due to the orbit of the
             Earth, for the prime meridian to point to the Sun again,
             which is a solar day. Used sizes and angles are
             illustrative, not realistic.}
    \label{fig:sidereal_time}
\end{figure}


\subsubsection{Greenwich Mean Sidereal Time (GMST)}

GMST is the hour angle of the vernal equinox (\secref{sec:celestial})
with respect to the prime meridian at Greenwich, expressed in decimal
hours \cite{kaplan:2011aa}. This is illustrated in
\figref{fig:wgs84_gmst_lst}.

\begin{equation}
    GMST = 6.697374558 + 0.06570982441908 D0 + 1.00273790935 H + 0.000026 T^2
\end{equation}

Here $D0$ is the number of days since the epoch J2000 (1 January, 2000
12:00 UTC or Julian date 2451545), $H$ is the number of hours since the
last midnight, and $T$ is the number of centuries since J2000.

\begin{figure}
    \centering
    \input{Figures/WGS84_GMST_LST}
    \caption{Top-down view of Earth showing the relation between GMST
             (teal) and LST (blue) for an observer at a longitude
             $\lambda$ (orange). The observer and prime meridian move with
             the rotation of the Earth, the vernal equinox does not.}
    \label{fig:wgs84_gmst_lst}
\end{figure}


\subsubsection{Local Sidereal Time (LST)}

Similar to GMST but takes observers longitude into account.

To get the Local Sidereal Time the observers longitude has to be added
to the GMST. This is illustrated in \figref{fig:wgs84_gmst_lst}. Since
the longitude is given in degrees is has to be divided by 15 to get
hours, because $\frac{\SI{360}{\degree}}{\SI{24}{\hour}} =
\SI{15}{\degree\per\hour}$, so the equation becomes:

\begin{equation}
    \begin{array}{l}
        \mathit{LST} = \mathit{GMST} + \frac{\lambda}{15} \ . \\
    \end{array}
\end{equation}


\section{Celestial}
\label{sec:celestial}

Here we describe the different coordinate systems that are used to
define the direction (origin) of an air shower. The Zenith and Azimuth
and Horizontal systems rotate with the rotation of the Earth, because
they are linked to the location of the observer. The Equatorial system
is linked to the celestial sphere and independent from the rotation of
Earth. To transform from Zenith and Azimuth to Equatorial the position
of the observer and time of observation are also required.


\subsection{Zenith and Azimuth}

When a station detects a shower we try to reconstruct the direction of
its origin. The direction of a shower is then given by an zenith and
azimuth coordinate. These coordinates define a point on the semi-sphere
that is the sky above the detection station. The Zenith is the point
directly above the observer. The zenith angle is the angle between the
direction and the Zenith point. The azimuth is the direction in the
horizontal plane, it starts at East (\SI{0}{\radian}) then goes to North
(ENWS). This is illustrated in pink in \figref{fig:enu_horizontal}.

We do not expect nor consider air showers from below the horizon, so the
zenith angles, defined in radians, are an angle in the range [0,
$\frac{\pi}{2}$). The azimuth is restricted to the range [$-\pi$, $\pi$).

\begin{figure}
    \centering
    \input{Figures/ENU_ZenAzi_Horizontal}
    \caption{Relationship between the ENU (green), Zenith Azimuth (pink)
             and horizontal (gold) coordinate systems.}
    \label{fig:enu_horizontal}
\end{figure}


\subsection{Horizontal}

This is a system used as intermediary for some coordinate conversions.
It uses azimuth ($A$) and altitude ($a$) to define a direction. The
altitude is the opposite of the zenith, so \SI{0}{\radian} is horizontal
and \SI{\pi / 2}{\radian} is the zenith. The azimuth definition also
differs, in Horizontal coordinates it moves from North to East (NESW).
This is illustrated in gold in \figref{fig:enu_horizontal}

The formulae to convert from zenith ($\theta$) and azimuth ($\phi$) to
altitude ($a$) and azimuth ($A$) are:

\begin{equation}
    \begin{array}{l}
        a = \frac{\pi}{2} - \theta \ , \\
        A = \frac{\pi}{2} - \phi \ . \\
    \end{array}
\end{equation}


\subsection{Equatorial (J2000)}

\figref{fig:celestial} shows the relation between the celestial sphere
and Equatorial coordinates. The right ascension ($\alpha$) is the angle
between the projection of the sky position ($\star$) on the plane of the
Celestial equator and the vernal equinox ($\vernal$). The declination
($\delta$) is the angle between the plane of the Celestial equator and
the sky position. Due to precession (change of the rotational axis) the
celestial positions slowly change over time, to compensate coordinates
are calculated as they would have been on a specific date, the J2000
epoch is commonly used. The equatorial coordinates are fixed to the
celestial sphere and not influenced by the rotation of the Earth.

\begin{figure}
    \centering
    \input{Figures/Equatorial}
    \caption{This figures shows the relation between a position on the
             sky (black), Equatorial coordinates (red), and the
             Celestial sphere.}
    \label{fig:celestial}
\end{figure}

Given an observers position in WGS84, a time of observation in LST and
horizontal coordinates pointing to the source the following formulae can
be used to get the corresponding equatorial coordinates \cite[p.
37]{duffet-smith:1990aa}.

\begin{equation}
    \begin{array}{l}
        \delta = \arcsin{\left((\sin{a} \sin{\phi}) +
                               (\cos{a} \cos{\phi} \cos{A})\right)} \ , \\
        \mathit{HA} = \arccos{\left(\frac{\sin{a} - (\sin{\phi} \sin{\delta})}
                                         {\cos{\phi} \cos{\delta}}\right)} \ , \\
        \alpha = \mathit{LST} - \mathit{HA} \ . \\
    \end{array}
\end{equation}

Where $\phi$ the geographical latitude, $a$ the altitude, $A$ the
azimuth, $\mathit{LST}$ the Local sidereal time, $\delta$ is the
declination, $\alpha$ the right ascension and the intermediate variable
$\mathit{HA}$ is the hour angle.


\begin{figure}
    \centering
    \input{Figures/WGS84_ZenAzi_LST_Equatorial}
    \caption{Relationship between the WGS84 (orange), Zenith azimuth (pink), 
             and clock (teal) and Equatorial (red) coordinate systems.
             $\vernal$ points to the vernal equinox, the point where the
             ecliptic and celestial equator cross in the Aries zodiac.}
    \label{fig:wgs84_equatorial}
\end{figure}


\section{\corsika}

\corsika an extensive air shower simulation program which we use.
\corsika uses a coordinate system which is slightly different from the
ENU system that we use \cite{heck:2013aa}.

\begin{figure}
    \centering
    \input{Figures/ENU_CORSIKA}
    \caption{Relationship between the ENU (green), Zenith Azimuth (pink)
             and CORSIKA (brown) coordinates.}
    \label{fig:enu_corsika}
\end{figure}


\subsection{Geographic}

\corsika defines positions on the ground (or observation level) relative
to the point where the shower axis intersects the observation level.
Positive x axis points to magnetic North, positive y axis to the West,
and the z axis upwards.

The formulae to convert CORSIKA to ENU are:

\begin{equation}
    \begin{array}{l}
        x_{\mathrm{ENU}} = -y_{\mathrm{CORSIKA}} \ , \\
        y_{\mathrm{ENU}} = x_{\mathrm{CORSIKA}} \ , \\
        z_{\mathrm{ENU}} = z_{\mathrm{CORSIKA}} \ . \\
    \end{array}
\end{equation}


\subsection{Celestial}

\corsika looks from the point of view of the shower, so not the
direction it came form, but the direction it goes to. The $\Theta$ angle
is defined the same as our definition of zenith ($\theta$),
\SI{0}{\radian} is a shower from the zenith and \SI{\pi / 2}{\radian} is
a horizontal shower. The $\Phi$ angle is defined differently than our
definition of azimuth ($\phi$). First is the angle the shower is heading
towards and secondly a different reference is used. \SI{0}{\radian} is a
shower heading towards North, so coming from South, which we would
define as \SI{-\pi / 2}{\radian}. The (positive) rotation of the angle is
in the same direction, from North to West.

The formulae to convert the CORSIKA direction to our azimuth and zenith are:

\begin{equation}
    \begin{array}{l}
        \theta = \Theta \ , \\
        \phi = \Phi - \frac{\pi}{2} \ . \\
    \end{array}
\end{equation}


\printbibliography
